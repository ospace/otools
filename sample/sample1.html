<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<title>sample1</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="description" content="" />
	<meta name="keywords" content="" />
	<meta name="robots" content="index,follow" />
</head>
<body>
	<h1>Binding</h1>
    <div id="foo" data-a1="a1" data-a2="a2">

        <div>
            <input type="text" placeholder="change me!!!" o-model="foo.name|upperCase"/>
            <span>Name: {{ foo.name | upperCase }}</span>
        </div>
        
        <div>
            <input type="RADIO" value="true" id="r1" o-model="foo.use" checked> <label for="r1">사용</label>
            <input type="RADIO" value="false" id="r2" o-model="foo.use"> <label for="r2">미사용</label>
            <span> - 사용여부:{{foo.use}}</span>
        </div>
        <div>
            <input type="RADIO" value="true" id="r3" o-model="foo.checked" checked> <label for="r3">선택</label>
            <input type="RADIO" value="false" id="r4" o-model="foo.checked"> <label for="r4">미선택</label>
        </div>
        
        <div>
            <input type="checkbox" id="r4" o-model="foo.use"><label for="r4">Use:{{foo.use}}</label>
            <input type="checkbox" id="r3" o-model="foo.checked"><label for="r3">Checked:{{foo.checked}}</label>
            
        </div>

        <div>
            <input type="checkbox" value="CHK1" o-model="checklist">
            <input type="checkbox" value="CHK2" o-model="checklist">
            <input type="checkbox" value="CHK3" o-model="checklist">
            <span>Checklist: {{checklist}}</span>
        </div>
        <div>
            <select o-model="selected">
                <option value="">select</option>
                <option value="true">사용</option>
                <option value="false">미사용</option>
            </select>
            <span>선택:{{selected}}</span>
        </div>
        <div>
            <select o-model="checklist" multiple>
                <option>CHK1</option>
                <option>CHK2</option>
                <option>CHK3</option>
            </select>
        </div>

        <div>
            <label for="r5">Message</label><input id="r5" type="text"><button type="button" onclick="onAdd(event)">ADD</button>
        </div>
        <table cellspacing="0" border="1" width="100%">
            <tr>
                <th>ID</th>
                <th>Message</th>
                <th>Input</th>
                <th></th>
            </tr>
            <tr o-for="items" o-key="id">
                <td align="center">{{id}}</td>
                <td align="center">{{message}}</td>
                <td align="center"><input type="text" o-model="message"></td>
                <td align="center"><button type="button" data-id="{{id}}">X</button></td>
            </tr>
        </table>
    </div>
    <script src="../src/otools.js"></script>
	<script>
        'use strict';
		console.log('running...');

        var data = {
            foo: {
                name:'foo',
                use:true,
                checked:false,
                actived:''
            },
            selected:'',
            checklist: [],
            useYn: function() { return this.selected==='true' ? true : false},
            items: [
                { message: 'foo', id:1},
                { message: 'bar', id:2},
                { message: 'fo1', id:3},
                { message: 'fo2', id:4},
                { message: 'fo3', id:5},
                { message: 'fo4', id:6},
                { message: 'fo5', id:7},
                { message: 'fo6', id:8},
                { message: 'fo7', id:9}
            ]
        }

        var domFoo = document.getElementById('foo');

        o.bindOf(data, domFoo);

        function upperCase(val) {
            return val && val.toUpperCase();
        }

        function  onAdd(ev) {
            var parent = ev.target.parentElement;
            var input = parent.querySelector('input[type=text]');
            var value = input.value;
            input.value  = '';
            var maxId = data.items.reduce(function (a, v) { return a < v.id ? v.id : a }, 0);
            data.items.push({message:value, id:maxId+1});
            
        }

        o.on(document.querySelector('table'), 'click', 'button', function(ev) {
            var id = ev.target.dataset.id;
            var idx = data.items.findIndex(function(it) { return it.id == id });
            if(!(idx && 0 <= idx))  {
                alert('item not found: '+id+'->'+idx);
                return;
            }
        
            data.items.splice(idx, 1);
        });
	</script>
</body>
</html>
